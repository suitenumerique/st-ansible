---
- name: "systemctl --user daemon-reload"
  become: true
  become_user: "{{ st_podman_user }}"
  become_method: ansible.builtin.sudo
  become_flags: "-i"
  ansible.builtin.systemd_service:
    daemon_reload: true
    scope: user

- name: "systemctl --user restart {{ st_podman_application_name }}"
  become: true
  become_user: "{{ st_podman_user }}"
  become_method: ansible.builtin.sudo
  become_flags: "-i"
  ansible.builtin.systemd_service:
    name: "{{ st_podman_application_name }}"
    state: restarted
    scope: user

- name: "sleep 10"
  become: false
  ansible.builtin.wait_for:
    timeout: 10
  delegate_to: localhost

- name: "systemctl --user is-active {{ st_podman_application_name }}"
  become: true
  become_user: "{{ st_podman_user }}"
  become_method: ansible.builtin.sudo
  become_flags: "-i"
  changed_when: false
  ansible.builtin.shell: |
    set -eu
    systemctl --user is-active {{ st_podman_application_name }}
