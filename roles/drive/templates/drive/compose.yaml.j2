---
{{ ansible_managed | comment }}

name: drive
services:
  nginx:
    container_name: nginx
    image: docker.io/nginx:1-alpine
    ports:
    - "{{ st_drive_nginx_port }}:50090"
    volumes:
      - {{ st_drive_dir }}/nginx_config/nginx.conf:/etc/nginx/conf.d/default.conf
    healthcheck:
      test: ["CMD", "curl", "--fail", "http://127.0.0.1:50090/healthcheck"]
      interval: 1m
      timeout: 3s
      start_period: 10s
  frontend:
    container_name: drive-frontend
    image: docker.io/lasuite/drive-frontend:{{ st_drive_tag }}
    env_file: ./frontend_env
    healthcheck:
      test: ["CMD-SHELL", "true"]
      interval: 1m
      timeout: 3s
      start_interval: 5s

  backend:
    container_name: drive-backend
    image: docker.io/lasuite/drive-backend:{{ st_drive_tag }}
    env_file: ./backend_env
    healthcheck:
      test: ["CMD-SHELL", "true"]
      interval: 1m
      timeout: 3s
      start_interval: 5s
