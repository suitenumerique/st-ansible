---
argument_specs:
  main:
    short_description: "Installs and configures the Messages application from La Suite Territoriale on Debian systems."
    options:
      st_messages_uid:
        type: "int"
        description: "UID of the `messages` user, used for the podman role."
        default: 1100
      st_messages_gid:
        type: "int"
        description: "GID of the `messages` group, used for the podman role."
        default: "{{ st_messages_uid }}"
      st_messages_mta_in_enabled:
        type: "bool"
        description: "Triggers the installation of the mta-in."
        default: false
      st_messages_mta_in_tag:
        type: "str"
        description: "Tag of the mta-in docker image to deploy."
        default: "main"
      st_messages_mta_in_dir:
        type: "str"
        description: "Remote path to the base directory for mta-in app."
        default: "/opt/messages/mta-in"
      st_messages_mta_in_env_template:
        type: "str"
        description: "Local path to the custom template to use for mta-in env file."
        default: "mta_in/env.j2"
      st_messages_mta_in_env:
        type: "str"
        description: "Content of the default mta_in_env_template, not used if st_messages_mta_in_env_template is defined."
      st_messages_mta_in_starttls_certificate_path:
        type: "str"
        description:
          - "Path of the starttls certificate on the remote host."
          - "The certificate must be in the smtpd_tls_chain_files format, see https://www.postfix.org/postconf.5.html#smtpd_tls_chain_files."
          - "The file must be accessible by the `messages` user."
      st_messages_mta_out_enabled:
        type: "bool"
        description: "Triggers the installation of the mta-out."
        default: false
      st_messages_mta_out_tag:
        type: "str"
        description: "Tag of the mta-out docker image to deploy."
        default: "main"
      st_messages_mta_out_dir:
        type: "str"
        description: "Remote path to the base directory for mta-out app."
        default: "/opt/messages/mta-out"
      st_messages_mta_out_env_template:
        type: "str"
        description: "Local path to the custom template to use for mta-out env file."
        default: "mta_out/env.j2"
      st_messages_mta_out_env:
        type: "str"
        description: "Content of the default mta_out_env_template, not used if st_messages_mta_out_env_template is defined."
      st_messages_socks_proxy_enabled:
        type: "bool"
        description: "Triggers the installation of the socks-proxy."
        default: false
      st_messages_socks_proxy_tag:
        type: "str"
        description: "Tag of the socks-proxy docker image to deploy."
        default: "main"
      st_messages_socks_proxy_dir:
        type: "str"
        description: "Remote path to the base directory for socks-proxy app."
        default: "/opt/messages/socks-proxy"
      st_messages_socks_proxy_env_template:
        type: "str"
        description: "Local path to the custom template to use for socks-proxy env file."
        default: "socks_proxy/env.j2"
      st_messages_socks_proxy_env:
        type: "str"
        description: "Content of the default socks_proxy_env_template, not used if st_messages_socks_proxy_env_template is defined."
      st_messages_mpa_enabled:
        type: "bool"
        description: "Triggers the installation of the mpa."
        default: false
      st_messages_mpa_dir:
        type: "str"
        description: "Remote path to the base directory for mpa app."
        default: "/opt/messages/mpa"
      st_messages_mpa_rspamd_tag:
        type: "str"
        description:
          - "The tag of the rspamd docker image to use."
          - "See https://hub.docker.com/r/rspamd/rspamd/tags."
        default: "3"
      st_messages_mpa_rspamd_controller_password:
        type: "str"
        description: "Password of the rspamd controller webui."
      st_messages_mpa_rspamd_neighbours:
        type: "list"
        elements: "str"
        description: "List of URLs to the rspamd neighbours controllers."
      st_messages_mpa_rspamd_config_templates:
        type: "list"
        elements: "dict"
        description: "List of rspamd configs to deploy, merged with the default configuration list."
        default: []
      st_messages_mpa_unbound_config_template:
        type: "str"
        description: "Local path to the unbound.conf template."
        default: "mpa/unbound.conf.j2"
      st_messages_mpa_clamav_tag:
        type: "str"
        description:
          - "The tag of the clamav docker image to use."
          - "See https://hub.docker.com/r/clamav/clamav/tags."
        default: "1.4"
      st_messages_mpa_clamav_config_template:
        type: "str"
        description: "Local path to the clamd.conf template."
        default: "mpa/clamd.conf.j2"
      st_messages_mpa_valkey_enabled:
        type: "bool"
        default: true
        description: "Triggers the installation of a local valkey instance, which also deploys a default redis.conf rspamd config."
      st_messages_mpa_valkey_tag:
        type: "str"
        description:
          - "The tag of the valkey docker image to use."
          - "See https://hub.docker.com/r/valkey/valkey/tags."
        default: "8"
      st_messages_monitoring_enabled:
        type: "bool"
        description: "Triggers the installation of the alloy agent, used to send metrics to a Prometheus compatible server and logs to a Loki server."
        default: false
      st_messages_monitoring_prometheus_url:
        type: "str"
        description: "When monitoring deployment is enabled, specifies the Prometheus URL to send metrics to."
      st_messages_monitoring_loki_url:
        type: "str"
        description: "When monitoring deployment is enabled, specifies the Loki URL to send logs to."
      st_messages_monitoring_cadvisor_port:
        type: "str"
        description: "The host published port of the cadvisor container."
        default: "127.0.0.1:58080"
